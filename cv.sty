%% Curriculum Vitae style file
%% Rob J Hyndman. Last updated 16 August 2011
%% This file may be modified, copied and redistributed without any further permission.
%% However, if you modify it, please add a note indicating it is a modification of the original.
%% The original file is available at http://robjhyndman.com/research/cv.sty

\usepackage{paralist}
%\usepackage{ragged2e}
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{enumitem}
\usepackage[margin=2cm]{geometry}
%\usepackage[a4paper,text={17.5cm,25.5cm},centering]{geometry}
\usepackage[compact,small,sf,bf]{titlesec}
\usepackage{kpfonts}
\usepackage{dsfont}
\usepackage{lastpage}

%\RaggedRight
\sloppy

% Header and footer
\pagestyle{fancy}
\lhead{\sf Curriculum Vitae: \@name}
\rhead{\sf\thepage of \pageref{LastPage}}
\cfoot{}

% Header box
\def\name#1{\def\@name{#1}}
\def\info#1{\def\@info{#1}}

\def\maketitle{
    \thispagestyle{plain}
    \section*{}
        \vspace*{-1.4cm}
        \parbox{.01\textwidth}{
            \begin{tabularx}{\textwidth}{l}
                \LARGE\textbf{\@name}\\[0.3cm]
                \Large\textbf{Curriculum Vitae}\\[0.6cm]
                \normalsize Updated \today
            \end{tabularx}
        }
        \parbox{1.7\textwidth}{
            \fontsize{9}{12}\sf
            \begin{tabularx}{\textwidth}{rX}
                \@info
            \end{tabularx}
        }
        \vspace*{0.2cm}
}


% Section headings
\titlelabel{}
\titlespacing{\section}{0pt}{2ex}{1ex}
\titleformat*{\section}{\large\sf\bfseries}
\titlespacing{\subsection}{0pt}{1ex}{0.5ex}

% Miscellaneous dimensions
\setlength{\parskip}{0ex}
\setlength{\parindent}{0em}
\setlength{\headheight}{15pt}
\setlength{\tabcolsep}{0.15cm}
\clubpenalty = 10000
\widowpenalty = 10000
\setlist{itemsep=1pt}
\setdescription{labelwidth=1.2cm,leftmargin=1.5cm,labelindent=1.5cm,font=\rm}

% Bibliography formatting

\usepackage[american]{babel}
\usepackage{csquotes}
%\usepackage[sorting=ydnt, style=apa, backend=biber]{biblatex}
\usepackage[sorting=ydnt,defernumbers=true,maxnames=20,giveninits=true, uniquename=init,dashed=false, style=apa]{biblatex}
\DeclareLanguageMapping{american}{american-apa}
\renewcommand{\maxprtauth}{99}

\DeclareFieldFormat{url}{\url{#1}}
\DeclareFieldFormat[article]{pages}{#1}
\DeclareFieldFormat[inproceedings]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[incollection]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[article]{volume}{\textbf{#1}}
\DeclareFieldFormat[article]{number}{(#1)}
\DeclareFieldFormat[article]{title}{\MakeCapital{#1}}
\DeclareFieldFormat[inproceedings]{title}{#1}
\DeclareFieldFormat{shorthandwidth}{#1}

% Bibliography categories
\def\makebibcategory#1#2{\DeclareBibliographyCategory{#1}\defbibheading{#1}{\section*{#2}}}

\setlength{\bibitemsep}{2.65pt}
\setlength{\bibhang}{.8cm}
\renewcommand{\bibfont}{\small}

\renewcommand*{\bibitem}{\addtocounter{papers}{1}\item \mbox{}\hskip-0.85cm\hbox to 0.85cm{\hfill\arabic{papers}.~~}}
\defbibenvironment{bibliography}
{\list{}
  {\setlength{\leftmargin}{\bibhang}%
   \setlength{\itemsep}{\bibitemsep}%
   \setlength{\parsep}{\bibparsep}}}
{\endlist}
{\bibitem}

\newenvironment{publications}{\section{Publications}\label{papersstart}\vspace*{0.2cm}\small
\titlespacing{\section}{0pt}{1.5ex}{1ex}\itemsep=0.00cm
}{\label{papersend}\addtocounter{sumpapers}{-1}\refstepcounter{sumpapers}\label{sumpapers}}

\def\printbib#1{\printbibliography[category=#1,heading=#1]\lastref{sumpapers}}

% Counters for keeping track of papers
\newcounter{papers}\setcounter{papers}{0}
\newcounter{sumpapers}\setcounter{sumpapers}{0}
\def\lastref#1{\addtocounter{#1}{\value{papers}}\setcounter{papers}{0}}

% Add all papers in the bib file.
\nocite{*}